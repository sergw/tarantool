test_run = require('test_run').new()
---
...
engine = test_run:get_cfg('engine')
---
...
box.sql.execute('pragma sql_default_engine=\''..engine..'\'')
---
...
-- Create space
box.sql.execute("CREATE TABLE t (id INTEGER PRIMARY KEY, v INTEGER UNIQUE ON CONFLICT ABORT)")
---
...
box.sql.execute("CREATE TABLE q (id INTEGER PRIMARY KEY, v INTEGER UNIQUE ON CONFLICT FAIL)")
---
...
box.sql.execute("CREATE TABLE p (id INTEGER PRIMARY KEY, v INTEGER UNIQUE ON CONFLICT IGNORE)")
---
...
box.sql.execute("CREATE TABLE e (id INTEGER PRIMARY KEY ON CONFLICT REPLACE, v INTEGER)")
---
...
-- Insert values and select them
box.sql.execute("INSERT INTO t values (1, 1), (2, 2), (3, 1)")
---
- error: Duplicate key exists in unique index 'unique_unnamed_T_2' in space 'T'
...
box.sql.execute("SELECT * FROM t")
---
- []
...
box.sql.execute("INSERT INTO q values (1, 1), (2, 2), (3, 1)")
---
- error: 'UNIQUE constraint failed: Q.V'
...
box.sql.execute("SELECT * FROM q")
---
- - [1, 1]
  - [2, 2]
...
box.sql.execute("INSERT INTO p values (1, 1), (2, 2), (3, 1), (4, 5)")
---
...
box.sql.execute("SELECT * FROM p")
---
- - [1, 1]
  - [2, 2]
  - [4, 5]
...
box.sql.execute("INSERT INTO e values (1, 1), (2, 2), (1, 3)")
---
...
box.sql.execute("SELECT * FROM e")
---
- - [1, 3]
  - [2, 2]
...
box.sql.execute("CREATE TABLE t1(a INT PRIMARY KEY ON CONFLICT REPLACE)")
---
...
box.sql.execute("INSERT INTO t1 VALUES (9)")
---
...
box.sql.execute("INSERT INTO t1 VALUES (9)")
---
...
box.sql.execute("SELECT * FROM t1")
---
- - [9]
...
box.sql.execute("CREATE TABLE t2(a INT PRIMARY KEY ON CONFLICT IGNORE)")
---
...
box.sql.execute("INSERT INTO t2 VALUES (9)")
---
...
box.sql.execute("INSERT INTO t2 VALUES (9)")
---
...
box.sql.execute("SELECT * FROM t2")
---
- - [9]
...
box.sql.execute('DROP TABLE t')
---
...
box.sql.execute('DROP TABLE q')
---
...
box.sql.execute('DROP TABLE p')
---
...
box.sql.execute('DROP TABLE e')
---
...
box.sql.execute('DROP TABLE t1')
---
...
box.sql.execute('DROP TABLE t2')
---
...
--
-- gh-3473: Primary key can't be declared with NULL.
--
box.sql.execute('CREATE TABLE te17 (s1 INT NULL PRIMARY KEY NOT NULL);')
---
- error: Primary index of the space 'TE17' can not contain nullable parts
...
box.sql.execute('CREATE TABLE te17 (s1 INT NULL PRIMARY KEY);')
---
- error: Primary index of the space 'TE17' can not contain nullable parts
...
box.sql.execute("CREATE TABLE test (a int PRIMARY KEY, b int NULL ON CONFLICT IGNORE);")
---
- error: 'SQL error: NULL declaration for column ''B'' of table ''TEST'' has been
    already set to ''none'''
...
box.sql.execute("CREATE TABLE test (a int, b int NULL, c int, PRIMARY KEY(a, b, c))")
---
- error: Primary index of the space 'TEST' can not contain nullable parts
...
